# QTDesigner的基本使用

## Q: 如何启动Designer?

### 准备工作

* **确认安装**: 确保已经正确安装相关工具包, 如果没有安装请参考[Python指令.txt]文件进行安装.

### 启动步骤

1. Win+R打开cmd
2. 输入`where python`
3. 选择python.exe所在的一个目录地址, 复制到资源管理器地址栏中打开
    * 例如: `C:\Users\Newland\AppData\Local\Programs\Python\Python36\python.exe`,
      选择`C:\Users\Newland\AppData\Local\Programs\Python\Python36`打开
4. 找到`\Python36\Lib\site-packages\qt5_applications\Qt\bin`目录, 运行`designer.exe`

## Q: 如何保存.ui文件?

### 保存步骤

1. 在Designer中选择文件-另存为
2. 选择一个目录进行保存

## Q: 如何将.ui文件转换为.py代码?

### 转换步骤

1. 将.ui文件放到目标目录
2. 在地址栏输入命令: `pyuic5 <文件名.ui> -o <文件名>.py`

### 命令示例

```bash
pyuic5 mywindow.ui -o mywindow.py
```

## Q: 如何使用生成的.py代码?

### 生成的.py文件结构说明

生成的.py文件中的`Ui_Form`类通常只包含两个方法: 一个`setupUi`和一个`retranslateUi`. 其中`retranslateUi`方法在`setupUi`
中自动调用, 因此不需要手动去调用它.

### 方法一: 使用外部类调用UI文件(推荐)

#### 实现步骤

1. 使用`pyuic5`命令将.ui文件转换为.py文件，生成`Ui_Form`类
2. 创建一个新的.py文件(如`main.py`)，导入生成的`Ui_Form`类
3. 在`main.py`中创建一个新的主类(如`MyWindow`)，继承自`QMainWindow`
4. 在`MyWindow`的`__init__`方法中，创建`Ui_Form`类的实例并调用其`setupUi`方法
5. 在主程序中创建`QApplication`实例和`MyWindow`实例
6. 调用`MyWindow`实例的`show()`方法展示窗口
7. 调用`QApplication`实例的`exec_()`方法启动事件循环

#### 代码结构

```
project/
├── main.py          # 主程序入口
├── mywindow.ui      # Designer设计的UI文件
├── mywindow.py      # 由pyuic5生成的Python代码
└── qtdesigner.py    # 自定义的主窗口类
```

#### 代码示例

**main.py (主程序入口):**

```python
import sys

from PyQt5.QtWidgets import QApplication, QMainWindow
from qtdesigner import Ui_Form


# 在外部引用UI类的写法，导入Ui_Form
# UI与业务逻辑分离，耦合度更低
class MyWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.ui = Ui_Form()
        self.ui.setupUi(self)
        # 以后要添加业务逻辑必须在setupUi后面添加
        # 记得养成好习惯写上self，使属性成为类的属性方便函数进行修改


if __name__ == '__main__':
    app = QApplication(sys.argv)
    window = MyWindow()
    window.show()
    sys.exit(app.exec_())
```

**qtdesigner.py (由pyuic5生成的UI类, 不需要进行任何更改以确保代码的低耦合性):**

```python
# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'qtdesigner.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

from PyQt5 import QtCore, QtGui, QtWidgets


class Ui_Form(object):
    def setupUi(self, Form):
        Form.setObjectName("Form")
        Form.resize(570, 300)
        Form.setAcceptDrops(False)
        self.pushButton = QtWidgets.QPushButton(Form)
        self.pushButton.setGeometry(QtCore.QRect(0, 0, 120, 30))
        self.pushButton.setObjectName("pushButton")
        self.label = QtWidgets.QLabel(Form)
        self.label.setGeometry(QtCore.QRect(0, 30, 120, 30))
        self.label.setObjectName("label")

        self.retranslateUi(Form)
        QtCore.QMetaObject.connectSlotsByName(Form)

    def retranslateUi(self, Form):
        _translate = QtCore.QCoreApplication.translate
        Form.setWindowTitle(_translate("Form", "这是一个自定义标题"))
        self.pushButton.setText(_translate("Form", "这是一个自定义按钮"))
        self.label.setText(_translate("Form", "这是一个自定义标签"))
```

### 参考文件

* [main.py](main.py)
* [qtdesigner.py](qtdesigner.py)

## 注意事项

### 路径说明

| 路径类型       | 说明                                                                 |
|------------|--------------------------------------------------------------------|
| Python安装路径 | `C:\Users\<用户名>\AppData\Local\Programs\Python\Python36`            |
| Designer路径 | `\Python36\Lib\site-packages\qt5_applications\Qt\bin\designer.exe` |
| 转换命令       | 在.ui文件所在目录执行`pyuic5 <文件名.ui> -o <文件名>.py`                          |

### 类方法说明

| 方法名             | 作用          | 调用方式            |
|-----------------|-------------|-----------------|
| `setupUi`       | 设置UI界面布局和组件 | 自动调用, 传入窗口实例    |
| `retranslateUi` | 翻译UI文本(国际化) | 在`setupUi`中自动调用 |